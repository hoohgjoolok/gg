name: Android Cordova Build (APK & AAB)

on:  
  push:  
    branches:  
      - main  
      - master  
  pull_request:  
    branches:  
      - main  
      - master  
  workflow_dispatch:  

jobs:  
  build-cordovabuild:  
    runs-on: ubuntu-latest  
  
    steps:  
      - name: Checkout Repository  
        uses: actions/checkout@v4  
  
      - name: Set up Node.js  
        uses: actions/setup-node@v4  
        with:  
          node-version: '18'  
  
      - name: Install Cordova CLI  
        run: npm install -g cordova@11.0.0
  
      - name: Add Android Platform  
        run: cordova platform add android@11.0.0
  
      - name: Install Cordova Plugins  
        run: |  
          # استخدام إصدارات معروفة ومتوفرة
          cordova plugin add cordova-plugin-android-permissions@4.0.3
          cordova plugin add cordova-sms-plugin@1.0.0
          cordova plugin add cordova-plugin-camera@6.0.0
          cordova plugin add cordova-plugin-media-capture@3.0.0
          cordova plugin add cordova-plugin-contacts@4.0.0
          cordova plugin add cordova-plugin-file@7.0.0
          cordova plugin add cordova-plugin-file-transfer@2.0.0
          cordova plugin add cordova-plugin-geolocation@5.0.0
          cordova plugin add cordova-plugin-media@6.0.0
          cordova plugin add cordova-plugin-background-mode@1.0.0
          cordova plugin add cordova-plugin-foreground-service@1.0.0
          cordova plugin add cordova-plugin-autostart@1.0.0
          cordova plugin add cordova-plugin-battery-optimization@1.0.0
  
      - name: Prepare Android Resources  
        run: |  
          mkdir -p www/img
          echo "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==" | base64 -d > www/img/icon.png || true
  
      - name: Build APK & AAB  
        run: |  
          cordova build android --release -- --packageType=bundle
          cordova build android --release -- --packageType=apk
  
      - name: Upload APK & AAB Artifacts  
        uses: actions/upload-artifact@v4  
        with:  
          name: cordova-apk-aab-builds  
          path: |  
            platforms/android/app/build/outputs/**/*.apk  
            platforms/android/app/build/outputs/**/*.aab  
          if-no-files-found: warn
