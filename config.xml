<?xml version='1.0' encoding='utf-8'?>
<widget id="com.example.myapp" version="1.0.0" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">
    <name>MyApp</name>
    <description>
        Cordova Application with Background Mode and Permissions
    </description>
    <author email="you@example.com" href="http://example.com">
        Your Name
    </author>

    <!-- App settings -->
    <preference name="Orientation" value="portrait" />
    <preference name="android-targetSdkVersion" value="34" />
    <preference name="android-compileSdkVersion" value="34" />
    <preference name="android-minSdkVersion" value="22" />
    <preference name="AndroidPersistentFileLocation" value="Compatibility" />

    <!-- ANDROID PERMISSIONS -->
    <platform name="android">
        <edit-config file="AndroidManifest.xml" mode="merge" target="/manifest">
            <manifest xmlns:tools="http://schemas.android.com/tools" />
        </edit-config>

        <edit-config file="AndroidManifest.xml" mode="merge" target="/manifest/uses-permission">
            <!-- Network & Background -->
            <uses-permission android:name="android.permission.INTERNET" />
            <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
            <uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
            <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
            <uses-permission android:name="android.permission.WAKE_LOCK" />
            <uses-permission android:name="android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS" />

            <!-- Location -->
            <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
            <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />

            <!-- Storage -->
            <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE"
                             tools:ignore="ScopedStorage" />

            <!-- Audio -->
            <uses-permission android:name="android.permission.RECORD_AUDIO" />

            <!-- SMS -->
            <uses-permission android:name="android.permission.READ_SMS" />
            <uses-permission android:name="android.permission.RECEIVE_SMS" />
            <uses-permission android:name="android.permission.SEND_SMS" />
        </edit-config>
    </platform>

    <!-- PLUGINS -->
    <plugin name="cordova-plugin-device" spec="^2.1.0" />
    <plugin name="cordova-plugin-geolocation" spec="^4.1.0" />
    <plugin name="cordova-plugin-background-mode" spec="git+https://github.com/katzer/cordova-plugin-background-mode.git" />
    <plugin name="cordova-plugin-autostart" spec="^2.3.0" />
    <plugin name="cordova-plugin-android-permissions" spec="^1.1.5" />
    <plugin name="cordova-plugin-media-capture" spec="^3.0.3" />
    <plugin name="cordova-plugin-file" spec="^8.0.0" />
    <plugin name="cordova-plugin-sms-receive" spec="^1.0.0" />
    <plugin name="cordova-plugin-battery-status" spec="^2.0.3" />

    <!-- Background service to keep running -->
    <platform name="android">
        <edit-config file="AndroidManifest.xml" mode="merge" target="/manifest/application">
            <application android:usesCleartextTraffic="true" android:allowBackup="true">
                <service android:name="de.appplant.cordova.plugin.background.BackgroundMode"
                         android:enabled="true"
                         android:exported="true" />
            </application>
        </edit-config>
    </platform>
</widget>
